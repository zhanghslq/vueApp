<template>
    <div>
      <div id="top" style="transition-duration: 300ms; transform: translateY(0px);">
        <img src="./每日优鲜_files/top.png" class="addr">
        <img src="./每日优鲜_files/search.png" class="search">
        <div class="swiper-container swiper-container-horizontal swiper-container-free-mode swiper-container-ios" id="nav">
          <div class="swiper-wrapper" style="transition-duration: 300ms; transform: translate3d(0px, 0px, 0px);">
            <div class="swiper-slide swiper-slide-active" style="width: 69px;">
              <span style="color: rgb(255, 72, 145); transition-duration: 300ms;">热卖</span></div>
            <div class="swiper-slide swiper-slide-next" style="width: 69px;">
              <span style="transition-duration: 300ms; color: rgb(51, 51, 51);">水果</span></div>
            <div class="swiper-slide" style="width: 69px;">
              <span style="transition-duration: 300ms; color: rgb(51, 51, 51);">乳品</span></div>
            <div class="swiper-slide" style="width: 69px;">
              <span style="transition-duration: 300ms; color: rgb(51, 51, 51);">零食</span></div>
            <div class="swiper-slide" style="width: 69px;">
              <span style="color: rgb(51, 51, 51); transition-duration: 300ms;">肉蛋</span></div>
            <div class="swiper-slide" style="width: 69px;">
              <span style="color: rgb(51, 51, 51); transition-duration: 300ms;">蔬菜</span></div>
            <div class="swiper-slide" style="width: 69px;">
              <span style="color: rgb(51, 51, 51); transition-duration: 300ms;">酒饮</span></div>
            <div class="swiper-slide" style="width: 69px;">
              <span style="color: rgb(51, 51, 51); transition-duration: 300ms;">速食</span></div>
            <div class="swiper-slide" style="width: 69px;">
              <span style="color: rgb(51, 51, 51); transition-duration: 300ms;">熟食</span></div>
            <div class="swiper-slide" style="width: 69px;">
              <span style="color: rgb(51, 51, 51); transition-duration: 300ms;">水产</span></div>
            <div class="swiper-slide" style="width: 69px;">
              <span style="color: rgb(51, 51, 51); transition-duration: 300ms;">粮油</span></div>
            <div class="swiper-slide" style="width: 69px;">
              <span style="color: rgb(51, 51, 51); transition-duration: 300ms;">轻食</span></div>
            <div class="swiper-slide" style="width: 69px;">
              <span style="color: rgb(51, 51, 51); transition-duration: 300ms;">火锅</span></div>
            <div class="swiper-slide" style="width: 69px;">
              <span style="color: rgb(51, 51, 51); transition-duration: 300ms;">日百</span></div>
            <div class="bar" style="width: 69px; transition-duration: 300ms; transform: translateX(0px);">
              <div class="color"></div>
            </div>
          </div>
        </div>
      </div>
      <div class="swiper-container swiper-container-horizontal swiper-container-ios" id="page">
        <div class="swiper-wrapper" style="transition-duration: 0ms; transform: translate3d(0px, 0px, 0px);">
          <div class="swiper-slide slidepage swiper-slide-active" style="width: 414px;">
            <div class="swiper-container scroll swiper-container-vertical swiper-container-free-mode swiper-container-ios">
              <div class="swiper-wrapper" style="transition-duration: 0ms; transform: translate3d(0px, 72px, 0px);">
                <div class="swiper-slide slidescroll swiper-slide-active">
                  <div class="swiper-container banner swiper-container-horizontal swiper-container-ios">
                    <div class="swiper-wrapper" style="transition-duration: 0ms; transform: translate3d(-828px, 0px, 0px);"><div class="swiper-slide swiper-slide-duplicate swiper-slide-duplicate-next" data-swiper-slide-index="2" style="width: 414px;">
                      <img src="./每日优鲜_files/banner3.jpg"></div>
                      <div class="swiper-slide swiper-slide-prev" data-swiper-slide-index="0" style="width: 414px;">
                        <img src="./每日优鲜_files/banner1.jpg"></div>
                      <div class="swiper-slide swiper-slide-active" data-swiper-slide-index="1" style="width: 414px;">
                        <img src="./每日优鲜_files/banner2.jpg"></div>
                      <div class="swiper-slide swiper-slide-next" data-swiper-slide-index="2" style="width: 414px;">
                        <img src="./每日优鲜_files/banner3.jpg"></div>
                      <div class="swiper-slide swiper-slide-duplicate swiper-slide-duplicate-prev" data-swiper-slide-index="0" style="width: 414px;">
                        <img src="./每日优鲜_files/banner1.jpg"></div></div>
                    <div class="swiper-pagination swiper-pagination-fraction"><span class="swiper-pagination-current">2</span>/<span class="swiper-pagination-total">3</span></div>
                  </div>
                  <div class="img">
                    <img src="./每日优鲜_files/index1.png">
                    <img src="./每日优鲜_files/hot.png"></div>
                  <ul class="img">
                    <li>
                      <img src="./每日优鲜_files/product1.png"></li>
                    <li>
                      <img src="./每日优鲜_files/product2.png"></li>
                    <li>
                      <img src="./每日优鲜_files/product3.png"></li>
                    <li>
                      <img src="./每日优鲜_files/product4.png"></li>
                    <li>
                      <img src="./每日优鲜_files/product5.png"></li>
                    <li>
                      <img src="./每日优鲜_files/product3.png"></li>
                    <li>
                      <img src="./每日优鲜_files/product4.png"></li>
                    <li>
                      <img src="./每日优鲜_files/product5.png"></li>
                    <li>
                      <img src="./每日优鲜_files/product3.png"></li>
                    <li>
                      <img src="./每日优鲜_files/product4.png"></li>
                    <li>
                      <img src="./每日优鲜_files/product5.png"></li>
                    <li>
                      <img src="./每日优鲜_files/product3.png"></li>
                    <li>
                      <img src="./每日优鲜_files/product4.png"></li>
                    <li>
                      <img src="./每日优鲜_files/product5.png"></li>
                  </ul>
                  <div class="img">
                    <img src="./每日优鲜_files/bottom.png"></div>
                </div>
              </div>
            </div>
          </div>


          <div class="swiper-slide slidepage swiper-slide-next" style="width: 414px;">
            <div class="swiper-container scroll swiper-container-vertical swiper-container-free-mode swiper-container-ios">
              <div class="swiper-wrapper" style="transition-duration: 0ms; transform: translate3d(0px, 72px, 0px);">
                <div class="swiper-slide slidescroll swiper-slide-active">
                  <div class="swiper-container banner swiper-container-horizontal swiper-container-ios">
                    <div class="swiper-wrapper" style="transition-duration: 0ms; transform: translate3d(-828px, 0px, 0px);"><div class="swiper-slide swiper-slide-duplicate swiper-slide-duplicate-next" data-swiper-slide-index="2" style="width: 414px;">
                      <img src="./每日优鲜_files/banner3.jpg"></div>
                      <div class="swiper-slide swiper-slide-prev" data-swiper-slide-index="0" style="width: 414px;">
                        <img src="./每日优鲜_files/banner1.jpg"></div>
                      <div class="swiper-slide swiper-slide-active" data-swiper-slide-index="1" style="width: 414px;">
                        <img src="./每日优鲜_files/banner2.jpg"></div>
                      <div class="swiper-slide swiper-slide-next" data-swiper-slide-index="2" style="width: 414px;">
                        <img src="./每日优鲜_files/banner3.jpg"></div>
                      <div class="swiper-slide swiper-slide-duplicate swiper-slide-duplicate-prev" data-swiper-slide-index="0" style="width: 414px;">
                        <img src="./每日优鲜_files/banner1.jpg"></div></div>
                    <div class="swiper-pagination swiper-pagination-fraction"><span class="swiper-pagination-current">2</span>/<span class="swiper-pagination-total">3</span></div>
                  </div>
                  <div class="img">
                    <img src="./每日优鲜_files/hot.png"></div>
                  <ul class="img">
                    <li>
                      <img src="./每日优鲜_files/product1.png"></li>
                    <li>
                      <img src="./每日优鲜_files/product2.png"></li>
                    <li>
                      <img src="./每日优鲜_files/product3.png"></li>
                    <li>
                      <img src="./每日优鲜_files/product4.png"></li>
                    <li>
                      <img src="./每日优鲜_files/product5.png"></li>
                    <li>
                      <img src="./每日优鲜_files/product3.png"></li>
                    <li>
                      <img src="./每日优鲜_files/product4.png"></li>
                    <li>
                      <img src="./每日优鲜_files/product5.png"></li>
                    <li>
                      <img src="./每日优鲜_files/product3.png"></li>
                    <li>
                      <img src="./每日优鲜_files/product4.png"></li>
                    <li>
                      <img src="./每日优鲜_files/product5.png"></li>
                    <li>
                      <img src="./每日优鲜_files/product3.png"></li>
                    <li>
                      <img src="./每日优鲜_files/product4.png"></li>
                    <li>
                      <img src="./每日优鲜_files/product5.png"></li>
                  </ul>
                  <div class="img">
                    <img src="./每日优鲜_files/bottom.png"></div>
                </div>
              </div>
            </div>
          </div>



          <div class="swiper-slide slidepage" style="width: 414px;">
            <div class="swiper-container scroll swiper-container-vertical swiper-container-free-mode swiper-container-ios">
              <div class="swiper-wrapper" style="transition-duration: 0ms; transform: translate3d(0px, 72px, 0px);">
                <div class="swiper-slide slidescroll swiper-slide-active">
                  <div style="height: 800px; width: auto; background-color: black"></div>
                  <div style="height: 800px; width: auto; background-color: red"></div>
                  <div style="height: 800px; width: auto; background-color: palegreen"></div>
                  <div style="height: 800px; width: auto; background-color: chartreuse"></div>
                  <div style="height: 800px; width: auto; background-color: grey"></div>


                </div></div>
            </div>
          </div>




          <div class="swiper-slide slidepage" style="width: 414px;">
            <div class="swiper-container scroll swiper-container-vertical swiper-container-free-mode swiper-container-ios">
              <div class="swiper-wrapper" style="transition-duration: 0ms; transform: translate3d(0px, 72px, 0px);">
                <div class="swiper-slide slidescroll swiper-slide-active">slide4</div></div>
            </div>
          </div>
          <div class="swiper-slide slidepage" style="width: 414px;">
            <div class="swiper-container scroll swiper-container-vertical swiper-container-free-mode swiper-container-ios">
              <div class="swiper-wrapper" style="transition-duration: 0ms; transform: translate3d(0px, 72px, 0px);">
                <div class="swiper-slide slidescroll swiper-slide-active">slide5</div></div>
            </div>
          </div>
          <div class="swiper-slide slidepage" style="width: 414px;">
            <div class="swiper-container scroll swiper-container-vertical swiper-container-free-mode swiper-container-ios">
              <div class="swiper-wrapper" style="transition-duration: 0ms; transform: translate3d(0px, 72px, 0px);">
                <div class="swiper-slide slidescroll swiper-slide-active">slide6</div></div>
            </div>
          </div>
          <div class="swiper-slide slidepage" style="width: 414px;">
            <div class="swiper-container scroll swiper-container-vertical swiper-container-free-mode swiper-container-ios">
              <div class="swiper-wrapper" style="transition-duration: 0ms; transform: translate3d(0px, 72px, 0px);">
                <div class="swiper-slide slidescroll swiper-slide-active">slide7</div></div>
            </div>
          </div>
          <div class="swiper-slide slidepage" style="width: 414px;">
            <div class="swiper-container scroll swiper-container-vertical swiper-container-free-mode swiper-container-ios">
              <div class="swiper-wrapper" style="transition-duration: 0ms; transform: translate3d(0px, 72px, 0px);">
                <div class="swiper-slide slidescroll swiper-slide-active">slide8</div></div>
            </div>
          </div>
          <div class="swiper-slide slidepage" style="width: 414px;">
            <div class="swiper-container scroll swiper-container-vertical swiper-container-free-mode swiper-container-ios">
              <div class="swiper-wrapper" style="transition-duration: 0ms; transform: translate3d(0px, 72px, 0px);">
                <div class="swiper-slide slidescroll swiper-slide-active">slide9</div></div>
            </div>
          </div>
          <div class="swiper-slide slidepage" style="width: 414px;">
            <div class="swiper-container scroll swiper-container-vertical swiper-container-free-mode swiper-container-ios">
              <div class="swiper-wrapper" style="transition-duration: 0ms; transform: translate3d(0px, 72px, 0px);">
                <div class="swiper-slide slidescroll swiper-slide-active">slide10</div></div>
            </div>
          </div>
          <div class="swiper-slide slidepage" style="width: 414px;">
            <div class="swiper-container scroll swiper-container-vertical swiper-container-free-mode swiper-container-ios">
              <div class="swiper-wrapper" style="transition-duration: 0ms; transform: translate3d(0px, 72px, 0px);">
                <div class="swiper-slide slidescroll swiper-slide-active">slide11</div></div>
            </div>
          </div>
          <div class="swiper-slide slidepage" style="width: 414px;">
            <div class="swiper-container scroll swiper-container-vertical swiper-container-free-mode swiper-container-ios">
              <div class="swiper-wrapper" style="transition-duration: 0ms; transform: translate3d(0px, 72px, 0px);">
                <div class="swiper-slide slidescroll swiper-slide-active">slide12</div></div>
            </div>
          </div>
          <div class="swiper-slide slidepage" style="width: 414px;">
            <div class="swiper-container scroll swiper-container-vertical swiper-container-free-mode swiper-container-ios">
              <div class="swiper-wrapper" style="transition-duration: 0ms; transform: translate3d(0px, 72px, 0px);">
                <div class="swiper-slide slidescroll swiper-slide-active">slide13</div></div>
            </div>
          </div>
          <div class="swiper-slide slidepage" style="width: 414px;">
            <div class="swiper-container scroll swiper-container-vertical swiper-container-free-mode swiper-container-ios">
              <div class="swiper-wrapper" style="transition-duration: 0ms; transform: translate3d(0px, 72px, 0px);">
                <div class="swiper-slide slidescroll swiper-slide-active">slide14</div></div>
            </div>
          </div>
        </div>
      </div>
      <div class="img" id="footer"><img src="./每日优鲜_files/footer.png"></div>
    </div>
</template>

<script>
  import Swiper from 'swiper'
    export default {
        name: "test",
      methods:{
        navTab:function (){
          //暂时设计每个slide大小需要一致
          let bar;
          let topBar;
          let barwidth = 36 //导航粉色条的长度px
          let tSpeed = 300 //切换速度300ms
          let clientWidth;
          let navSum;
          let navSlideWidth;
          let  navWidth;
          var navSwiper = new Swiper('#nav', {
            slidesPerView: 5,
            freeMode: true,
            on: {
              init: function() {
                console.log(this)
                navSlideWidth = this.slides.eq(0).css('width'); //导航字数需要统一,每个导航宽度一致
                bar = this.$el.find('.bar')
                bar.css('width', navSlideWidth)
                bar.transition(tSpeed)
                navSum = this.slides[this.slides.length - 1].offsetLeft //最后一个slide的位置

                clientWidth = parseInt(this.$wrapperEl.css('width')) //Nav的可视宽度
                navWidth = 0
                for (let i = 0; i < this.slides.length; i++) {
                  navWidth += parseInt(this.slides.eq(i).css('width'))
                }
                topBar = this.$el.parents('body').find('#top') //页头

              },

            },
          });
          let progress;
          var pageSwiper = new Swiper('#page', {
            watchSlidesProgress: true,
            resistanceRatio: 0,
            on: {
              slideChange: function () {
                console.log(this.activeIndex);
              },
              touchMove: function() {
                progress = this.progress

                bar.transition(0)
                bar.transform('translateX(' + navSum * progress + 'px)')
                //粉色255,72,145灰色51,51,51
                for (let i = 0; i < this.slides.length; i++) {
                  let slideProgress = this.slides[i].progress
                  if (Math.abs(slideProgress) < 1) {
                    let r = Math.floor((235 - 51) * (1 - Math.pow(Math.abs(slideProgress), 2)) + 51)
                    let g = Math.floor((189 - 51) * (1 - Math.pow(Math.abs(slideProgress), 2)) + 51)
                    let b = Math.floor((104 - 51) * (1 - Math.pow(Math.abs(slideProgress), 2)) + 51)
                    navSwiper.slides.eq(i).find('span').css('color', 'rgba(' + r + ',' + g + ',' + b + ',1)')
                  }
                }
              },
              transitionStart: function() {
                let activeIndex = this.activeIndex
                let activeSlidePosition = navSwiper.slides[activeIndex].offsetLeft
                //释放时导航粉色条移动过渡
                bar.transition(tSpeed)
                bar.transform('translateX(' + activeSlidePosition + 'px)')
                //释放时文字变色过渡
                navSwiper.slides.eq(activeIndex).find('span').transition(tSpeed)
                navSwiper.slides.eq(activeIndex).find('span').css('color', 'rgba(235,189,104,1)')
                if (activeIndex > 0) {
                  navSwiper.slides.eq(activeIndex - 1).find('span').transition(tSpeed)
                  navSwiper.slides.eq(activeIndex - 1).find('span').css('color', 'rgba(102,102,102,1)')
                }
                if (activeIndex < this.slides.length) {
                  navSwiper.slides.eq(activeIndex + 1).find('span').transition(tSpeed)
                  navSwiper.slides.eq(activeIndex + 1).find('span').css('color', 'rgba(102,102,102,1)')
                }
                //导航居中
                let navActiveSlideLeft = navSwiper.slides[activeIndex].offsetLeft //activeSlide距左边的距离

                navSwiper.setTransition(tSpeed)
                if (navActiveSlideLeft < (clientWidth - parseInt(navSlideWidth)) / 2) {
                  navSwiper.setTranslate(0)
                } else if (navActiveSlideLeft > navWidth - (parseInt(navSlideWidth) + clientWidth) / 2) {
                  navSwiper.setTranslate(clientWidth - navWidth)
                } else {
                  navSwiper.setTranslate((clientWidth - parseInt(navSlideWidth)) / 2 - navActiveSlideLeft)
                }

              },
            }
          });

          navSwiper.on('tap', function() {
            let clickIndex = this.clickedIndex
            let clickSlide = this.slides.eq(clickIndex)
            pageSwiper.slideTo(clickIndex, 0);
            this.slides.find('span').css('color', 'rgba(102,102,102,1)');
            clickSlide.find('span').css('color', 'rgba(235,189,104,1)');
          })

          //内容滚动
          let startPosition;
          var scrollSwiper = new Swiper('.scroll', {
            //65是头部的高
            //36是top地址和搜索的高
            slidesOffsetBefore: 72,
            direction: 'vertical',
            freeMode: true,
            slidesPerView: 'auto',
            mousewheel: {
              releaseOnEdges: true,
            },
          })
        },
      },
      mounted:function () {
        this.navTab()
      }
    }

</script>

<style scoped>
@import "每日优鲜_files/swiper.min.css";
@import "每日优鲜_files/style.css";
</style>
